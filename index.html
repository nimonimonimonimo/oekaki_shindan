<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>ãŠçµµã‹ãã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­ï½œãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ç‰ˆ</title>
<meta name="theme-color" content="#0b0d12">
<meta property="og:title" content="ãŠçµµã‹ãã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­">
<meta property="og:description" content="25å•ã§å‰µä½œã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨ºæ–­ã€‚ãƒˆãƒƒãƒ—1å¼·èª¿ï¼‹MAXå¤–å‘¨ãƒ‰ãƒƒãƒˆã®ãƒ¬ãƒ¼ãƒ€ãƒ¼ä»˜ãã€‚">
<meta property="og:type" content="website">
<meta property="og:image" content="ogp.png">
<meta name="twitter:card" content="summary_large_image">
<style>
:root{
  --bg:#0b0d12; --panel:#111624; --ink:#e8edf8; --muted:#a4afc7;
  --edge:#232c44; --t1:#88a0ff; --t2:#ff6ad5; --glow:0 10px 30px rgba(136,160,255,.25);
  --safe: env(safe-area-inset-bottom, 0px);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif;
  color:var(--ink);
  background:radial-gradient(1200px 800px at 80% -10%,#1a1f2d 0%,#0b0d12 55%) fixed;
  -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
}
.wrap{max-width:1040px;margin:0 auto;padding:24px 16px 120px}
header{text-align:center;margin-bottom:22px}
.brand{font-weight:900;letter-spacing:.02em;font-size:clamp(22px,4vw,36px)}
.sub{color:var(--muted);font-size:14px;margin-top:6px}
.muted{color:var(--muted)}
.card{
  background:linear-gradient(180deg,#14192a 0%,#0f1421 100%);
  border:1px solid var(--edge);border-radius:16px;padding:18px;margin:14px 0;
  box-shadow:0 12px 30px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.03)
}
.btn{
  border:0;border-radius:12px;padding:14px 18px;font-weight:800;cursor:pointer;
  min-height:48px
}
.primary{background:linear-gradient(180deg,var(--t1),var(--t2));color:#fff;box-shadow:var(--glow);font-size:16px}
.primary:active{transform:translateY(1px)}
.secondary{background:#171e32;color:#dfe6ff;border:1px solid var(--edge)}
.input{margin:14px 0}
.input input{
  width:100%;background:#0b0f1b;border:1px solid var(--edge);border-radius:10px;padding:12px 14px;color:#e8ecff;outline:none;font-size:16px
}
.progress{height:8px;background:#151a25;border:1px solid var(--edge);border-radius:999px;overflow:hidden;margin-bottom:12px}
.progress>div{height:100%;width:0;background:linear-gradient(90deg,var(--t1),var(--t2));transition:width .2s}
.qhead{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
.qnum{display:inline-block;background:#1a2136;border:1px solid var(--edge);color:#cfd8ff;padding:2px 8px;border-radius:999px;font-size:12px;margin-right:8px}
.qtext{font-size:18px;font-weight:700;line-height:1.5}
.navs{display:flex;gap:8px}
.navs .btn{padding:10px 12px}
.navs .btn[disabled]{opacity:.5;cursor:not-allowed}
.choices{display:grid;gap:10px;margin-top:12px}
@media(min-width:680px){.choices{grid-template-columns:1fr 1fr 1fr}}
.choice{
  border:1px solid var(--edge);background:#12192e;color:#e8ecff;padding:14px 12px;border-radius:12px;
  font-weight:800;cursor:pointer;text-align:left;line-height:1.45
}
.choice:active{transform:translateY(1px)}
.result{display:none;animation:fade .35s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.big{font-size:20px;font-weight:900;line-height:1.4}
.tags{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.tag{font-size:12px;background:#1a2239;border:1px solid #2a3350;color:#d4ddff;padding:5px 10px;border-radius:999px}
.badge{display:inline-block;padding:6px 12px;border-radius:999px;font-size:12px;background:linear-gradient(90deg,var(--t1),var(--t2));color:#0b0d12;font-weight:900;margin-left:8px}
.slab{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:13px;color:#bcd0ff}
.canvaswrap{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
#chartBox{
  background:#0c1222;border:1px solid var(--edge);border-radius:12px;padding:12px;position:relative;overflow:hidden;
}
#radar{display:block;width:100%;height:auto}
.small{font-size:12px;color:#a9b4cc}
.note{font-size:14px;color:#cfe1ff;background:#0e1424;border:1px solid #263050;border-radius:10px;padding:12px;line-height:1.6}
.hr{height:1px;background:linear-gradient(90deg,transparent,#2b3452,transparent);margin:12px 0}
.frame{
  border-radius:16px;padding:14px;
  background:radial-gradient(700px 240px at 0% 0%,rgba(255,255,255,.03),transparent 60%),linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.00));
  border:1px solid #2b3555;box-shadow:0 12px 34px rgba(0,0,0,.35)
}
footer{max-width:1040px;margin:40px auto;color:#96a2bb;font-size:12px;text-align:center}
.grid{display:grid;gap:12px}
.grid2{grid-template-columns:1.2fr 1fr}
@media(min-width:980px){#result .grid2{display:grid}}
/* ======== ã‚¹ãƒãƒ›æœ€é©åŒ– ======== */
@media (max-width: 768px){
  .wrap{padding-bottom:160px} /* ä¸‹éƒ¨å›ºå®šãƒãƒ¼åˆ†ã®ä½™ç™½ */
  #result .grid2{display:block}
  .big{font-size:18px}
  .tag{font-size:12px}
  .note{font-size:14px}
  .card{padding:14px}
  .btn{width:100%}
  #chartBox{padding:10px}
}
/* ä¸‹éƒ¨å›ºå®šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ï¼ˆçµæœæ™‚ã®ã¿è¡¨ç¤ºï¼‰ */
.actionbar{
  position:fixed;left:0;right:0;bottom:0;z-index:50;
  display:none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤ºã€‚çµæœæ™‚ã«JSã§è¡¨ç¤º */
  padding:10px 12px calc(10px + var(--safe));
  background:linear-gradient(180deg, rgba(10,12,20,0.0), rgba(10,12,20,0.85) 30%, rgba(10,12,20,0.95));
  backdrop-filter: blur(10px);
  border-top:1px solid #22304e;
}
.actionbar .row{max-width:1040px;margin:0 auto;display:grid;gap:10px;grid-template-columns:1fr 1fr}
@media (min-width: 768px){ .actionbar{display:none!important} } /* PCã§ã¯å‡ºã•ãªã„ */
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">ãŠçµµã‹ãã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­</div>
    <div class="sub">25å•ã®ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€ã‚ãªãŸã®å‰µä½œã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨ºæ–­ã€‚</div>
  </header>

  <!-- Intro -->
  <div id="intro" class="card" style="text-align:center">
    <p>ã¾ãšã¯åå‰ï¼ˆã¾ãŸã¯ãƒãƒ³ãƒ‰ãƒ«ãƒãƒ¼ãƒ ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
    <div class="input"><input id="uname" placeholder="ä¾‹ï¼šãƒ‹ãƒ¢ãƒ‹ãƒ " autocomplete="name" inputmode="text"></div>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button type="button" class="btn secondary" id="aboutbtn" onclick="toggleAbout()">è¨ºæ–­ã®èª¬æ˜</button>
      <button type="button" class="btn primary" id="startbtn" onclick="startQuiz()">è¨ºæ–­ã‚’å§‹ã‚ã‚‹</button>
    </div>
    <div id="about" class="small" style="display:none;margin-top:10px">
      5ã¤ã®è»¸ï¼ˆç›´æ„Ÿ/ç†å±ˆãƒ»å³èˆˆ/è¨ˆç”»ãƒ»æ„Ÿæƒ…/ç†æ€§ãƒ»å‹¢ã„/å®Œç’§ãƒ»æŠ½è±¡/å…·ä½“ï¼‰ã‚’3æŠÃ—25å•ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚
    </div>
  </div>

  <!-- Quiz -->
  <div id="quizwrap" style="display:none">
    <div class="card">
      <div class="qhead">
        <div><span id="qnum" class="qnum">Q1/25</span><span class="small">ç›´æ„Ÿã§ç­”ãˆã¦OK</span></div>
        <div class="navs">
          <button type="button" class="btn secondary" id="backbtn" onclick="goBack()">â† æˆ»ã‚‹</button>
          <button type="button" class="btn secondary" id="homebtn" onclick="goHome()">ãƒ›ãƒ¼ãƒ </button>
        </div>
      </div>
      <div class="progress"><div id="bar"></div></div>
    </div>
    <div class="card" id="quiz">
      <div class="qtext" id="qtext">â€¦</div>
      <div id="choices" class="choices"></div>
    </div>
  </div>

  <!-- Result -->
  <div id="result" class="result"></div>
</div>

<!-- ãƒ¢ãƒã‚¤ãƒ«ä¸‹éƒ¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ï¼ˆçµæœæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
<div class="actionbar" id="actionbar">
  <div class="row">
    <button type="button" class="btn secondary" id="copytxt_m">ã‚·ã‚§ã‚¢æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
    <button type="button" class="btn primary" id="tweetbtn_m">X(Twitter)ã§ã‚·ã‚§ã‚¢</button>
  </div>
</div>

<footer><p>Â© 2025 ãŠçµµã‹ãã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­ â€” situation edition</p></footer>

<script>
'use strict';

/* ==== failsafeï¼šã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•° + addEventListener ==== */
let uname="", idx=0, answers=[];
const el = id => document.getElementById(id);
function toggleAbout(){ const a=el('about'); a.style.display=(a.style.display==='none')?'block':'none'; }
function startQuiz(){
  const v=(el('uname')?.value||"").trim() || "ã‚²ã‚¹ãƒˆ";
  uname=v; el('intro').style.display='none'; el('quizwrap').style.display='block';
  idx=0; answers.length=0; renderQ();
  window.scrollTo({top:0,behavior:'smooth'});
}
function goHome(){ el('quizwrap').style.display='none'; el('result').style.display='none'; el('intro').style.display='block'; el('actionbar').style.display='none'; }
function goBack(){ if(idx>0){ idx--; renderQ(true); window.scrollTo({top:0,behavior:'smooth'});} }
window.startQuiz = startQuiz; window.toggleAbout = toggleAbout; window.goHome = goHome; window.goBack = goBack;
(function bindOnce(){
  const s=el('startbtn'), a=el('aboutbtn'), h=el('homebtn'), b=el('backbtn'), n=el('uname');
  try{
    if(s) s.addEventListener('click', startQuiz);
    if(a) a.addEventListener('click', toggleAbout);
    if(h) h.addEventListener('click', goHome);
    if(b) b.addEventListener('click', goBack);
    if(n) n.addEventListener('keydown', e=>{ if(e.key==='Enter') startQuiz(); });
  }catch(e){ console.error('binding failed', e); }
  setTimeout(()=>{ if(s && !s.onclick) s.onclick = startQuiz; }, 150);
})();

/* ========= å®šæ•° ========= */
const EXAGGERATE = 1.6;
const SMOOTH_ALPHA = 0.45;

/* ========= è»¸ã¨è³ªå• ========= */
const AXES = [
  {key:"intuition", pos:"ç›´æ„Ÿ", neg:"ç†å±ˆ", posHue:"#ff9b6b", negHue:"#7fb4ff"},
  {key:"improv",    pos:"å³èˆˆ", neg:"è¨ˆç”»", posHue:"#ffd36b", negHue:"#88a0ff"},
  {key:"emotion",   pos:"æ„Ÿæƒ…", neg:"ç†æ€§", posHue:"#ff7ea6", negHue:"#9cd0ff"},
  {key:"momentum",  pos:"å‹¢ã„", neg:"å®Œç’§", posHue:"#a0ffd3", negHue:"#b5c7ff"},
  {key:"abstract",  pos:"æŠ½è±¡", neg:"å…·ä½“", posHue:"#c6a6ff", negHue:"#ff8a6b"}
];
const Q = [
  {axis:0,q:"é›»è»Šã®å¾…ã¡æ™‚é–“ã«ã‚¹ã‚±ãƒƒãƒãƒ–ãƒƒã‚¯ã‚’é–‹ã„ãŸã‚‰ï¼Ÿ",c:["ä½•ã‚‚è€ƒãˆãšç·šã‚’èµ°ã‚‰ã›ã‚‹","å‘¨ã‚Šã®äººã‚„é¢¨æ™¯ã‚’è¦³å¯Ÿã—ã¦æã","ã–ã£ãã‚Šæ§‹å›³ã‚’æ±ºã‚ã¦ã‹ã‚‰æã"]},
  {axis:0,q:"æ–°ã—ã„ã‚­ãƒ£ãƒ©ã‚’è€ƒãˆã‚‹ã¨ã",c:["é ­ã«æµ®ã‹ã‚“ã ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¸€æ°—ã«æã","è¨­å®šã‚„ä¸–ç•Œè¦³ã‚’æ•´ç†ã—ã¦ã‹ã‚‰æã","ãƒ©ãƒ•ã§æ¢ã‚ŠãªãŒã‚‰é€²ã‚ã‚‹"]},
  {axis:0,q:"é…è‰²ã‚’æ±ºã‚ã‚‹ã¨ã",c:["ä»Šã®æ°—åˆ†ã§é¸ã¶","è‰²ç›¸ç’°ã‚„è£œè‰²ã§é¸ã¶","ã©ã¡ã‚‰ã‚‚æ··ãœã‚‹"]},
  {axis:0,q:"çŸ¥ã‚‰ãªã„ç”»æã‚’æ¸¡ã•ã‚ŒãŸã‚‰ï¼Ÿ",c:["ã¨ã«ã‹ãè©¦ã™","ã¾ãšä½¿ã„æ–¹ã‚’èª¿ã¹ã‚‹","å°‘ã—èª¿ã¹ã¦ã‹ã‚‰è©¦ã™"]},
  {axis:0,q:"æããªãŒã‚‰ã®æ°—æŒã¡",c:["ãƒãƒªã§æ‰‹ãŒå‹•ã","æ¬¡ã®å·¥ç¨‹ã‚’è€ƒãˆãªãŒã‚‰é€²ã‚ã‚‹","åŠã€…ãã‚‰ã„"]},
  {axis:1,q:"å‹é”ã«1é€±é–“å¾Œã®èª•ç”Ÿæ—¥ã‚¤ãƒ©ã‚¹ãƒˆã‚’é ¼ã¾ã‚ŒãŸã‚‰ï¼Ÿ",c:["ãã®æ—¥ã®ã†ã¡ã«æã","æ¯æ—¥å°‘ã—ãšã¤é€²ã‚ã‚‹","æ°—åˆ†ã§å¤‰ãˆã‚‹"]},
  {axis:1,q:"ãƒ©ãƒ•ã®æ‰±ã„ã¯ï¼Ÿ",c:["ã»ã¼ã—ãªã„","ãã£ã¡ã‚Šæã","å½¢ã ã‘è»½ãæã"]},
  {axis:1,q:"ç–²ã‚Œã¦ã¦ã‚‚æããªã‚‰ï¼Ÿ",c:["å‹¢ã„ã§æãå§‹ã‚ã‚‹","ä¼‘ã‚“ã§ã‹ã‚‰æã","æ°—åˆ†æ¬¡ç¬¬"]},
  {axis:1,q:"å®Œæˆå½¢ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ï¼Ÿ",c:["æããªãŒã‚‰è¦‹ã¤ã‘ã‚‹","æœ€åˆã«æ±ºã‚ã‚‹","ãƒ©ãƒ•ã§ã¼ã‚“ã‚„ã‚Šæƒ³åƒ"]},
  {axis:1,q:"ç· åˆ‡ãŒæ˜æ—¥ãªã®ã«é€²ã‚“ã§ãªã„ï¼",c:["å¾¹å¤œã§ä¸€æ°—ã«æã","è¨ˆç”»é€šã‚Šé€²ã‚ã‚‹","çŠ¶æ³ã«åˆã‚ã›ã¦èª¿æ•´"]},
  {axis:2,q:"å¤±æ‹ã—ãŸç›´å¾Œã«æãã¨ã—ãŸã‚‰ï¼Ÿ",c:["æ³£ããªãŒã‚‰æ„Ÿæƒ…ã‚’ã¶ã¤ã‘ã‚‹","å†·é™ã«æ§‹å›³ã‚„ãƒ†ãƒ¼ãƒã«ã™ã‚‹","ä¸¡æ–¹æ··ãœã‚‹"]},
  {axis:2,q:"æ˜ ç”»ã®æ„Ÿæƒ³ã‚’çµµã«ã™ã‚‹ãªã‚‰ï¼Ÿ",c:["æ„Ÿæƒ…ã‚’æŠ½è±¡çš„ã«æã","ã‚¹ãƒˆãƒ¼ãƒªãƒ¼è¦ç´ ã‚’æ•´ç†ã—ã¦æã","åŠã€…ã«å…¥ã‚Œã‚‹"]},
  {axis:2,q:"æ°—åˆ†ãŒæ²ˆã‚“ã§ã„ã‚‹æ—¥",c:["ãƒ€ãƒ¼ã‚¯ãªçµµã‚’æã","å†·é™ãªç·šç”»ç·´ç¿’ã‚’ã™ã‚‹","æ—¥ã«ã‚ˆã‚‹"]},
  {axis:2,q:"æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚’æ±ºã‚ã‚‹ã¨ã",c:["ä½“é¨“ã‚„æ„Ÿæƒ…ã‹ã‚‰é¸ã¶","çŸ¥è­˜ã‚„ç†è«–ã‹ã‚‰é¸ã¶","ãã®æ™‚æ¬¡ç¬¬"]},
  {axis:2,q:"è‰²ã‚’å¡—ã‚‹ç¬é–“",c:["å¿ƒã§æ±ºã‚ã‚‹","ç†ã§æ±ºã‚ã‚‹","æ··ãœã‚‹"]},
  {axis:3,q:"SNSã«ä¸Šã’ã‚‹ã¨ã",c:["ãƒ©ãƒ•ã§ã‚‚å‡ºã™","å®Œç’§ã«ä»•ä¸Šã’ã¦ã‹ã‚‰å‡ºã™","çŠ¶æ³ã§æ±ºã‚ã‚‹"]},
  {axis:3,q:"ä½œå“ã®æœ€å¾Œã®1æ™‚é–“",c:["å‹¢ã„ã§ä»•ä¸Šã’ã‚‹","ç´°éƒ¨ã‚’è©°ã‚ã‚‹","ãã“ãã“æ•´ãˆã‚‹"]},
  {axis:3,q:"å¤±æ•—ã«æ°—ã¥ã„ãŸã‚‰ï¼Ÿ",c:["ãã®ã¾ã¾çªã£èµ°ã‚‹","å…¨éƒ¨ã‚„ã‚Šç›´ã™","éƒ¨åˆ†çš„ã«ä¿®æ­£"]},
  {axis:3,q:"ä½œæ¥­æ™‚é–“ãŒäºˆå®šã‚’è¶…ãˆãŸã¨ã",c:["æ–°ã—ã„ä½œå“ã«åˆ‡ã‚Šæ›¿ãˆã‚‹","æœ€å¾Œã¾ã§ä»•ä¸Šã’ã‚‹","æ§˜å­ã‚’è¦‹ã¦åˆ¤æ–­"]},
  {axis:3,q:"å…¬é–‹å‰ã«è¦‹è¿”ã™ï¼Ÿ",c:["è¦‹è¿”ã•ãšæŠ•ç¨¿","ç´°éƒ¨ã¾ã§ãƒã‚§ãƒƒã‚¯","è»½ãç¢ºèª"]},
  {axis:4,q:"ç¾è¡“é¤¨ã§å¼·ãå¿ƒã‚’å‹•ã‹ã•ã‚ŒãŸã¨ã",c:["è‰²ã‚„é›°å›²æ°—ã‚’æã","äººç‰©ã‚„ç‰©èªã‚’æã","ä¸¡æ–¹"]},
  {axis:4,q:"è¡—ã‚’æ­©ã„ã¦ã„ã¦æããŸããªã£ãŸã‚‰ï¼Ÿ",c:["å…‰ã‚„ç©ºæ°—æ„Ÿã‚’æã","çœ‹æ¿ã‚„äººã‚’æã","æ··ãœã‚‹"]},
  {axis:4,q:"ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã¤ã‘ã‚‹ãªã‚‰ï¼Ÿ",c:["æŠ½è±¡èªï¼ˆæ°¸é ãƒ»è™šç„¡ï¼‰","å…·ä½“èªï¼ˆå¤ã®å¸°ã‚Šé“ï¼‰","ä¸¡æ–¹ä½¿ã†"]},
  {axis:4,q:"æ€ã„å‡ºã‚’æããªã‚‰ï¼Ÿ",c:["é›°å›²æ°—ã‚„ç©ºæ°—æ„Ÿ","ä¸€ç·’ã«ã„ãŸäººã‚„ç‰©","ä¸¡æ–¹"]},
  {axis:4,q:"åˆå¯¾é¢ã®äººã‚’ãƒ†ãƒ¼ãƒã«ã™ã‚‹ãªã‚‰ï¼Ÿ",c:["å°è±¡ã‚„ã‚ªãƒ¼ãƒ©ã‚’æã","é¡”ã‚„æœè£…ã‚’æã","ä¸¡æ–¹"]}
];

/* ========= ã‚¿ã‚¤ãƒ—åãƒ»èª¬æ˜ ========= */
const TYPE_NAMES_4 = {
  "1111":"çƒˆç«ã®ã‚¹ã‚±ãƒƒãƒãƒ£ãƒ¼","1110":"å¹»å½©ã®èª¿å¾‹è€…","1101":"æ··æ²Œã®ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ã‚¹ãƒˆ","1100":"é™å¯‚ã®æ§‹ç¯‰å£«",
  "1011":"æµæ˜Ÿã®ãƒ‰ãƒ©ãƒ•ã‚¿ãƒ¼","1010":"å¤¢å¹»ã®æ§‹ç¯‰è€…","1001":"ç¨²å¦»ã®æˆ¦ç•¥å®¶","1000":"æœªæ¥ã®éŒ¬æˆå¸«",
  "0111":"æ¿€æƒ…ã®åˆ†æè€…","0110":"é™è¬ã®è§£å‰–è€…","0101":"å†·å…‰ã®ã‚¹ãƒˆãƒ©ã‚¤ã‚«ãƒ¼","0100":"ç§©åºã®å®ˆè­·è€…",
  "0011":"åŠ‡å ´ã®è¨­è¨ˆå£«","0010":"é™ã‹ãªéŒ¬é‡‘è¡“å¸«","0001":"æ€è€ƒã®èˆªæµ·å£«","0000":"æ°¸é ã®è£½å›³å¸«"
};
const TYPE_DESC_4 = {
  "1111":"è¡å‹•ã¨è‰²ã§ä¸–ç•Œã‚’åˆ‡ã‚Šè£‚ãç¬ç™ºå‹ã€‚ä»•ä¸Šã’ã‚ˆã‚Šâ€œä»Šâ€ã‚’åˆ»ã‚€ã“ã¨ã«ä¾¡å€¤ã€‚",
  "1110":"æ„Ÿè¦šã‚’ä¿¡ã˜ã¤ã¤ç£¨ãä¸Šã’ã‚‹èª¿å¾‹ã‚¿ã‚¤ãƒ—ã€‚ç›´æ„Ÿã¨å®Œæˆåº¦ã®ä¸¡ç«‹ã€‚",
  "1101":"å‹¢ã„ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ½œã¾ã›ã‚‹å¥‡è¥²å‹ã€‚é›‘ç„¶ã«è¦‹ãˆã¦è¨­è¨ˆæ¸ˆã¿ã€‚",
  "1100":"é™ã‹ãªé›†ä¸­ã§ç›´æ„Ÿã‚’çµæ™¶åŒ–ã€‚å¯¡é»™ã«ç©ã¿ä¸Šã’ã‚‹æ§‹ç¯‰æ´¾ã€‚",
  "1011":"ä¸€ç¬ã®æƒ…ç†±ã‚’ä¸‹çµµã«è½ã¨ã™æµæ˜Ÿã‚¿ã‚¤ãƒ—ã€‚ç²—ã•ã¯æ¨é€²åŠ›ã€‚",
  "1010":"æƒ…å‹•ã‚’ç©å±¤ã—ç‰©èªã«å¤‰ãˆã‚‹æ§‹ç¯‰è€…ã€‚é…ãã¦ã‚‚æ·±ã„ã€‚",
  "1001":"ç›´æ„Ÿã‚’å³åº§ã«æˆ¦è¡“åŒ–ã€‚æ±ºæ–­ãŒé€Ÿãæ§‹æˆãŒé‹­ã„ã€‚",
  "1000":"ç›´æ„Ÿã‚’å†·é™ã«ç£¨ãé•·æœŸæˆ¦ã§å‹ã¤ã€‚ç‹é“ã®å®Œæˆåº¦ã€‚",
  "0111":"å¿ƒã®ç†±ã‚’åˆ†æã§å¢—å¹…ã™ã‚‹ç§‘å­¦æ´¾ã€‚çˆ†ç™ºã¨æ¤œè¨¼ã®å…±å­˜ã€‚",
  "0110":"æ„Ÿæƒ…ã‚’ç´°éƒ¨ã¸åˆ†è§£ã—ã¦æãè¦³å¯Ÿè€…ã€‚é™ã‹ã«å¼·ã„ã€‚",
  "0101":"ç†ã§ç¬ç™ºã™ã‚‹ã‚¹ãƒŠã‚¤ãƒ‘ãƒ¼ã€‚ç·šã¨æ§‹å›³ã§åˆ‡ã‚Šå–ã‚‹ã€‚",
  "0100":"ç§©åºã®å®ˆè­·è€…ã€‚ä¸å¯§ã§ç ´ç¶»ãªã—ã€å …ç‰¢ãªå®Œæˆä¸»ç¾©ã€‚",
  "0011":"æ„Ÿæƒ…ã‚’è„šæœ¬é€šã‚Šã«æ¼”å‡ºã€‚è¦‹ã›å ´ã‚’ä½œã‚‹èˆå°ç›£ç£å‹ã€‚",
  "0010":"å¿ƒã‚’æ²ˆã‚æ§‹é€ ã¸é‚„å…ƒã™ã‚‹éŒ¬é‡‘è¡“ã€‚é™è¬ã«ç©ã‚€ã€‚",
  "0001":"ç†æ€§ã§è’æ³¢ã‚’é€²ã‚€é–‹æ‹“è€…ã€‚åˆ¤æ–­ãŒæ·¡ã€…ã¨é€Ÿã„ã€‚",
  "0000":"æ§‹é€ ã®æœã¦ã‚’è¿½ã†è¨­è¨ˆè€…ã€‚æ¥µé™ã¾ã§ç£¨ãçµ‚ç€ç‚¹å¿—å‘ã€‚"
};

/* ========= å‡ºé¡Œãƒ»æ¡ç‚¹ãƒ»çµæœè¡¨ç¤º ========= */
function renderQ(){
  const item = Q[idx];
  el('qtext').textContent = item.q;
  el('qnum').textContent = `Q${idx+1}/${Q.length}`;
  el('bar').style.width = (idx/Q.length*100) + '%';
  const backbtn = el('backbtn'); if(backbtn) backbtn.disabled = (idx===0);

  const box = el('choices'); box.innerHTML = '';
  item.c.forEach((label,i)=>{
    const b = document.createElement('button');
    b.className = 'choice'; b.type='button'; b.textContent = label;
    if(answers[idx]===i){ b.style.borderColor='#5b6ca0'; b.style.boxShadow='0 0 0 2px rgba(136,160,255,.25)'; }
    b.addEventListener('click', ()=>{ answers[idx]=i; idx++; (idx<Q.length)?renderQ():finish(); });
    box.appendChild(b);
  });
}

function finish(){
  el('bar').style.width = '100%';
  el('quizwrap').style.display = 'none';

  const vec = [0,0,0,0,0]; // å„è»¸ã« [-5..5]
  for(let i=0;i<Q.length;i++){
    const s = answers[i]===0 ? 1 : answers[i]===1 ? -1 : 0;
    vec[Q[i].axis] += s;
  }
  const sig4 = vec.slice(0,4).map(v=> v>=1?1:0).join("");
  const abs = suffixForAbstract(vec[4]);
  const baseName = TYPE_NAMES_4[sig4] || "æœªå®šç¾©ã‚¿ã‚¤ãƒ—";
  const baseDesc = TYPE_DESC_4[sig4] || "";
  const colors = themeFor(sig4, abs.flavor);
  applyTheme(colors);

 el('result').innerHTML = `
  <div class="frame canvaswrap">
    <div id="chartBox">
      <svg id="radar" viewBox="0 0 360 320" preserveAspectRatio="xMidYMid meet" aria-label="ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ"></svg>
    </div>
  </div>
  <div class="frame">
    <div class="big"><span class="slab">${escapeHtml(uname)}</span> ã¯ <span class="badge">${baseName}${abs.suffix}</span></div>
    <div id="caps" class="tags"></div>
    <div id="summary" class="muted"></div>
    <div class="hr"></div>
    <div id="tend" class="note"></div>
    <div class="hr"></div>
    <div id="materialHint" class="note"></div>
    <div class="small" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
      <button type="button" class="btn secondary" onclick="goHome()">æœ€åˆã®ç”»é¢ã¸æˆ»ã‚‹</button>
      <button type="button" class="btn secondary" id="redo">å›ç­”ã‚’è¦‹ç›´ã™</button>
      <button type="button" class="btn secondary" id="copytxt">ã‚·ã‚§ã‚¢æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
      <button type="button" class="btn primary" id="tweetbtn">X(Twitter)ã§ã‚·ã‚§ã‚¢</button>
    </div>
  </div>
`;

      <div class="frame canvaswrap">
        <div id="chartBox">
          <svg id="radar" viewBox="0 0 360 320" preserveAspectRatio="xMidYMid meet" aria-label="ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ"></svg>
        </div>
      </div>
    </div>
  `;
  el('result').style.display = 'block';

  // ã‚¹ãƒãƒ›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼è¡¨ç¤ºï¼†ã‚¤ãƒ™ãƒ³ãƒˆç´ä»˜ã‘
  const ab = el('actionbar'); ab.style.display = 'block';
  el('copytxt_m').onclick = ()=> copyShare(uname, baseName+abs.suffix, buildSummary(vec));
  el('tweetbtn_m').onclick = ()=> openTweet(uname, baseName+abs.suffix, buildSummary(vec));

  // ã‚¿ã‚°ç¾¤
  const caps = el('caps');
  AXES.forEach((ax,i)=>{
    const v = vec[i];
    const label = v>1? ax.pos : v<-1? ax.neg : "ä¸­åº¸";
    const t = document.createElement('span');
    t.className='tag'; t.textContent = `${ax.pos}â†”${ax.neg}ï¼š${label}ï¼ˆ${v}ï¼‰`;
    caps.appendChild(t);
  });

  const sumText = buildSummary(vec);
  const desc = `${baseDesc} ${suffixForAbstract(vec[4]).extra}`;
  const catchy = catchyLine(vec);
  el('summary').innerHTML = `<p class="muted" style="line-height:1.7">${desc}</p><p class="muted">${sumText}</p><p class="muted">${catchy}</p>`;
  el('tend').innerHTML = tendencyText(vec);
  el('materialHint').innerHTML = `<span class="small">ãŠã¾ã‘ï¼š</span>ã‚¢ãƒŠãƒ­ã‚°/ãƒ‡ã‚¸ã‚¿ãƒ«ã®å‚¾å‘ãƒ’ãƒ³ãƒˆ â†’ ${materialHint5(sig4, vec[4])}`;

  // ãƒ¬ãƒ¼ãƒ€ãƒ¼æç”»ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼‰
  drawRadarResponsive(vec, colors);

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  el('redo').addEventListener('click', ()=>{
    el('result').style.display='none'; el('quizwrap').style.display='block';
    el('actionbar').style.display='none';
    idx = Q.length-1; renderQ(true); window.scrollTo({top:0,behavior:'smooth'});
  });
  el('copytxt').addEventListener('click', ()=> copyShare(uname, baseName+abs.suffix, sumText));
  el('tweetbtn').addEventListener('click', ()=> openTweet(uname, baseName+abs.suffix, sumText));
}

/* ========= æ–‡ç« /ãƒ†ãƒ¼ãƒ/è‰² ========= */
function buildSummary(vec){
  return [
    `ç›´æ„Ÿ/ç†å±ˆï¼š${vec[0] >= 2 ? "ç›´æ„Ÿå¯„ã‚Š" : vec[0] <= -2 ? "ç†å±ˆå¯„ã‚Š" : "ãƒãƒ©ãƒ³ã‚¹å‹"}`,
    `å³èˆˆ/è¨ˆç”»ï¼š${vec[1] >= 2 ? "å³èˆˆæ´¾" : vec[1] <= -2 ? "è¨ˆç”»æ´¾" : "çŠ¶æ³å¯¾å¿œæ´¾"}`,
    `æ„Ÿæƒ…/ç†æ€§ï¼š${vec[2] >= 2 ? "æ„Ÿæƒ…å„ªä½" : vec[2] <= -2 ? "ç†æ€§å„ªä½" : "ä¸­åº¸"}`,
    `å‹¢ã„/å®Œç’§ï¼š${vec[3] >= 2 ? "å‹¢ã„é‡è¦–" : vec[3] <= -2 ? "å®Œç’§ä¸»ç¾©" : "è¦ç‚¹ä»•ä¸Šã’"}`,
    `æŠ½è±¡/å…·ä½“ï¼š${vec[4] >= 2 ? "æŠ½è±¡å¿—å‘" : vec[4] <= -2 ? "å…·ä½“å¿—å‘" : "ä¸¡ç«‹æ´¾"}`
  ].join("ï½œ");
}
function suffixForAbstract(v){
  if(v>=2) return {suffix:"ï¼ˆæŠ½è±¡å¿—å‘ï¼‰", extra:"ç©ºæ°—ãƒ»ãƒªã‚ºãƒ ãƒ»ä½™ç™½ã®è¨­è¨ˆãŒå¼·ã¿ã€‚", flavor:"abstract"};
  if(v<=-2) return {suffix:"ï¼ˆå…·ä½“å¿—å‘ï¼‰", extra:"ãƒ¢ãƒãƒ¼ãƒ•ã®æ˜ç¢ºã•ãƒ»æƒ…å ±è¨­è¨ˆãŒæ­¦å™¨ã€‚", flavor:"concrete"};
  return {suffix:"ï¼ˆæŠ½è±¡Ã—å…·ä½“ãƒãƒ©ãƒ³ã‚¹ï¼‰", extra:"é›°å›²æ°—ã¨æƒ…å ±ã‚’ä¸¡ç«‹ã§ãã‚‹èª¿åœè€…ã€‚", flavor:"balanced"};
}
function themeFor(sig4, absFlavor){
  const baseMap = {
    "1111":["#ff8a6b","#ffd36b"], "1110":["#ff9bd4","#ffd36b"], "1101":["#8a7bff","#ff6ad5"], "1100":["#7ec8ff","#88a0ff"],
    "1011":["#ffb36b","#88ff9b"], "1010":["#c6a6ff","#88a0ff"], "1001":["#88a0ff","#5df0ff"], "1000":["#a0ffd3","#88a0ff"],
    "0111":["#ff7ea6","#88ffc6"], "0110":["#9cd0ff","#cfe1ff"], "0101":["#88f0ff","#b3e2ff"], "0100":["#b5c7ff","#d7e0ff"],
    "0011":["#ffd36b","#ff8ad6"], "0010":["#d0d6ff","#b0b8ff"], "0001":["#a8b6ff","#88a0ff"], "0000":["#d0d6ff","#b0b8ff"]
  }[sig4] || ["#8a7bff","#ff6ad5"];
  if(absFlavor==="abstract") return ["#9db8ff","#88a0ff"];
  if(absFlavor==="concrete") return ["#ffb36b","#ff8a6b"];
  return baseMap;
}
function applyTheme(colors){
  const [c1,c2]=colors;
  document.documentElement.style.setProperty('--t1', c1);
  document.documentElement.style.setProperty('--t2', c2);
  document.documentElement.style.setProperty('--glow', `0 10px 30px ${hexToRgba(c1,.25)}`);
}
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
function copyShare(uname, title, sum){
  const text = `${uname}ã¯ã€Œ${title}ã€ã€‚\n${sum}\n#ãŠçµµã‹ãã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­`;
  navigator.clipboard.writeText(text).then(()=> alert("ã‚·ã‚§ã‚¢æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼")).catch(()=> alert("ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸâ€¦"));
}
function openTweet(uname, title, sum){
  const text = `${uname}ã¯ã€Œ${title}ã€ã€‚\n${sum}\n#ãŠçµµã‹ãã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­`;
  const url = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(text);
  window.open(url, "_blank");
}
function materialHint5(sig4, absV){
  const base = {
    "1111":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¬ãƒƒã‚·ãƒ¥/ã‚¢ã‚¯ãƒªãƒ« ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Procreate",
    "1110":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¬ãƒƒã‚·ãƒ¥ ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Procreate/CSP",
    "1101":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¢ã‚¯ãƒªãƒ« ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Clip Studio",
    "1100":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¢ã‚¯ãƒªãƒ«åšå¡—ã‚Š ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Photoshop",
    "1011":"ã‚¢ãƒŠãƒ­ã‚°: ãƒ‘ã‚¹ãƒ†ãƒ«/ã‚ªã‚¤ãƒ«ãƒ‘ã‚¹ãƒ†ãƒ« ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Procreate",
    "1010":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¢ã‚¯ãƒªãƒ«/æ²¹å½© ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: CSP/Photoshop",
    "1001":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¢ã‚¯ãƒªãƒ« ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Illustrator + CSP",
    "1000":"ã‚¢ãƒŠãƒ­ã‚°: æ²¹å½©/ã‚¢ã‚¯ãƒªãƒ« ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Photoshop",
    "0111":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¤ãƒ³ã‚¯ï¼‹ãƒãƒ¼ã‚«ãƒ¼ ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: CSP(ç·šç”»)",
    "0110":"ã‚¢ãƒŠãƒ­ã‚°: è‰²é‰›ç­†/é‰›ç­† ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: CSP/SAI",
    "0101":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¤ãƒ³ã‚¯ ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Illustrator/ãƒ™ã‚¯ã‚¿ãƒ¼",
    "0100":"ã‚¢ãƒŠãƒ­ã‚°: å®šç€ç³»(è‰²é‰›ç­†/æ²¹å½©) ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Photoshop",
    "0011":"ã‚¢ãƒŠãƒ­ã‚°: ã‚³ãƒ©ãƒ¼ã‚¸ãƒ¥/æ¼”å‡ºç³» ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: AfterEffects",
    "0010":"ã‚¢ãƒŠãƒ­ã‚°: è‰²é‰›ç­†/é‰›ç­† ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: CSP",
    "0001":"ã‚¢ãƒŠãƒ­ã‚°: ã‚¤ãƒ³ã‚¯ï¼‹è¨­è¨ˆ ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Illustrator",
    "0000":"ã‚¢ãƒŠãƒ­ã‚°: æ²¹å½©/å®šç€ç³» ï½œ ãƒ‡ã‚¸ã‚¿ãƒ«: Photoshop/Illustrator"
  }[sig4] || "ã‚¢ãƒŠãƒ­ã‚°/ãƒ‡ã‚¸ã‚¿ãƒ«ï¼šè‡ªç”±ã«é¸æŠ";
  const abs = absV>=2 ? "ï½œæŠ½è±¡ï¼šæ°´å½©/ã‚¤ãƒ³ã‚¯/ãƒ†ã‚¯ã‚¹ãƒãƒ£éŠã³" : absV<=-2 ? "ï½œå…·ä½“ï¼šã‚¤ãƒ³ã‚¯ç·šç”»/CSPã§å¡—ã‚Š" : "ï½œæŠ½è±¡Ã—å…·ä½“ï¼šã©ã¡ã‚‰ã‚‚OK";
  return base + abs;
}
function tendencyText(vec){
  function phrase(v,pos,neg){
    if(v>=3) return `å¼·ã„${pos}ğŸ”¥`;
    if(v===2) return `${pos}å¯„ã‚Šâ¬†`;
    if(v===1) return `${pos}ã‚„ã‚„å„ªå‹¢â†—`;
    if(v===0) return `ãƒãƒ©ãƒ³ã‚¹âš–`;
    if(v===-1) return `${neg}å„ªå‹¢`;
    if(v===-2) return `${neg}å¯„ã‚Š`;
    return `${neg}å¼·ã‚`;
  }
  const p = [
    `ã‚¢ã‚¤ãƒ‡ã‚¢æºæ³‰ï¼š${phrase(vec[0],"ç›´æ„Ÿ","ç†å±ˆ")}`,
    `é€²ã‚æ–¹ã€€ã€€ã€€ï¼š${phrase(vec[1],"å³èˆˆ","è¨ˆç”»")}`,
    `å¿ƒã®ã‚ˆã‚Šã©ã“ã‚ï¼š${phrase(vec[2],"æ„Ÿæƒ…","ç†æ€§")}`,
    `ä»•ä¸Šã’æ–¹ã€€ã€€ï¼š${phrase(vec[3],"å‹¢ã„","å®Œç’§")}`,
    `ãƒ¢ãƒãƒ¼ãƒ•å‚¾å‘ï¼š${phrase(vec[4],"æŠ½è±¡","å…·ä½“")}`
  ].join("ï¼");
  return `ğŸ‘€ å‚¾å‘ã¾ã¨ã‚ï¼š<br>${p}`;
}
function catchyLine(vec){
  const top = [0,1,2,3,4].sort((a,b)=> Math.abs(vec[b]) - Math.abs(vec[a]) );
  const k = top[0];
  const side = vec[k]>=0 ? AXES[k].pos : AXES[k].neg;
  const flair = vec[k]>=0 ? "âš¡" : "â›";
  const noun = ["å›è·¯","èˆªè·¯","è»Œè·¡","å¾‹å‹•","è³ªé‡"][k];
  return `ã€Œ${side}${flair}ã€ãŒä¸»æ—‹å¾‹ã€‚æ‰‹ã¯${noun}ã‚’è¾¿ã‚ŠãªãŒã‚‰ã€ã‚ãªãŸã®åƒã‚’çµã¶ã€‚`;
}

/* ========= ãƒ¬ãƒ¼ãƒ€ãƒ¼ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æç”»ï¼‰ ========= */
function angles10(){ const a=[]; const base=-Math.PI/2, step=2*Math.PI/10; for(let i=0;i<10;i++) a.push(base+i*step); return a; }
function exaggerate01(x){ const y = 0.5 + (x-0.5)*EXAGGERATE; return Math.max(0, Math.min(1, y)); }
function smoothRing(arr, alpha=0.45){
  const n = arr.length; const out = new Array(n);
  for(let i=0;i<n;i++){
    const prev = arr[(i-1+n)%n], cur = arr[i], next = arr[(i+1)%n];
    const m = (prev + cur + next)/3;
    out[i] = cur*(1-alpha) + m*alpha;
  }
  return out;
}
function dominantTop1(vec){
  const idx = [0,1,2,3,4].sort((a,b)=> Math.abs(vec[b]) - Math.abs(vec[a]) )[0];
  const sign = Math.sign(vec[idx]);
  const i = sign>=0? idx : idx+5;
  return {idx:i, ax:idx, sign:sign, mag:Math.abs(vec[idx])};
}
function strongestAxes(vec){
  const mags = vec.map(v=>Math.abs(v));
  const maxv = Math.max.apply(null, mags);
  const res = [];
  for(let ax=0; ax<5; ax++){
    if(Math.abs(vec[ax]) === maxv){
      const i = vec[ax] >= 0 ? ax : ax+5;
      res.push(i);
    }
  }
  return res;
}
function drawSectorGlow(svg, cx, cy, r, a0, a1, color){
  const x0 = cx + Math.cos(a0)*r, y0 = cy + Math.sin(a0)*r;
  const x1 = cx + Math.cos(a1)*r, y1 = cy + Math.sin(a1)*r;
  const large = (a1-a0)%(2*Math.PI) > Math.PI ? 1 : 0;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d', `M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} Z`);
  path.setAttribute('fill', color);
  path.setAttribute('fill-opacity','0.22');
  svg.appendChild(path);
}
function avgAbs(vec){ return (Math.abs(vec[0])+Math.abs(vec[1])+Math.abs(vec[2])+Math.abs(vec[3])+Math.abs(vec[4]))/5; }

function drawRadarResponsive(vec, colors){
  const svg = el('radar');
  // ã‚µã‚¤ã‚ºæ±ºå®šï¼šè¦ªå¹…ã‚’åŸºæº–ã«é«˜ã•ã¯æ¯”ç‡ã§
  const box = el('chartBox');
  const w = Math.max(260, Math.min(box.clientWidth, 560)); // ã‚¹ãƒãƒ›ã§å¤§ãã™ããªã„ãƒ»å°ã•ã™ããªã„
  const h = Math.round(w * (320/360));
  svg.setAttribute('width', w);
  svg.setAttribute('height', h);

  // åŸç‚¹ãƒ»åŠå¾„ã‚¹ã‚±ãƒ¼ãƒ«
  const scale = w / 360;           // viewBoxåŸºæº–
  const cx = 180 * scale;
  const cy = 170 * scale;
  const r  = 120 * scale;

  while(svg.firstChild) svg.removeChild(svg.firstChild);
  const ang = angles10();

  // grid polygons
  for(let k=1;k<=5;k++){
    const rr = r*(k/5);
    const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    const pts = ang.map(a=>`${cx+Math.cos(a)*rr},${cy+Math.sin(a)*rr}`).join(' ');
    poly.setAttribute('points', pts);
    poly.setAttribute('fill','none');
    poly.setAttribute('stroke','#2a3454');
    poly.setAttribute('stroke-opacity','0.6');
    svg.appendChild(poly);
  }
  // labels
  const labelsPos = AXES.map(a=>a.pos);
  const labelsNeg = AXES.map(a=>a.neg);
  for(let i=0;i<10;i++){
    const a = ang[i];
    const x = cx+Math.cos(a)*r, y = cy+Math.sin(a)*r;
    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', x + (Math.cos(a)>0?6:-6));
    t.setAttribute('y', y + (Math.sin(a)>0?16:-6));
    t.setAttribute('text-anchor', Math.cos(a)>0.2?'start':Math.cos(a)<-0.2?'end':'middle');
    t.setAttribute('fill', '#cfe1ff');
    t.setAttribute('font-size', String(11*scale));
    t.setAttribute('font-weight','600');
    const ax = i%5;
    t.textContent = (i<5) ? labelsPos[ax] : labelsNeg[ax];
    svg.appendChild(t);
  }

  // å€¤â†’åŠå¾„ï¼ˆ0..1ï¼‰
  const t = vec.map(v=> (v===0 ? 0.5 : (v+5)/10) );
  const rad = [];
  for(let ax=0;ax<5;ax++) rad.push(exaggerate01(t[ax]));
  for(let ax=0;ax<5;ax++) rad.push(exaggerate01(1 - t[ax]));
  const radSm = smoothRing(rad, SMOOTH_ALPHA);

  const avg = avgAbs(vec);
  const fillOpacity = 0.22 + 0.5*(avg/5);
  const pts = radSm.map((val,i)=>{
    const rr = r*val; const a = ang[i];
    return `${cx+Math.cos(a)*rr},${cy+Math.sin(a)*rr}`;
  }).join(' ');

  const under = document.createElementNS('http://www.w3.org/2000/svg','polygon');
  under.setAttribute('points', pts);
  under.setAttribute('fill', colors[0]);
  under.setAttribute('fill-opacity', String(Math.min(0.28, fillOpacity*0.6)));
  svg.appendChild(under);

  const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
  poly.setAttribute('points', pts);
  poly.setAttribute('fill', colors[0]);
  poly.setAttribute('fill-opacity', String(fillOpacity));
  poly.setAttribute('stroke', colors[1]);
  poly.setAttribute('stroke-opacity','0.98');
  poly.setAttribute('stroke-width', String(2.6*scale));
  svg.appendChild(poly);

  // ã‚»ã‚¯ã‚¿ãƒ¼ã‚°ãƒ­ãƒ¼ï¼†ãƒˆãƒƒãƒ—1ãƒãƒ¼ã‚«ãƒ¼
  const top1 = dominantTop1(vec);
  const topAngle = ang[top1.idx];
  const hue = (top1.idx<5)? AXES[top1.ax].posHue : AXES[top1.ax].negHue;
  drawSectorGlow(svg, cx, cy, r*1.03, topAngle-(Math.PI/10)*0.9, topAngle+(Math.PI/10)*0.9, hexToRgba(hue,0.26));
  const rr = r*radSm[top1.idx];
  const mx = cx+Math.cos(topAngle)*rr, my = cy+Math.sin(topAngle)*rr;
  const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
  dot.setAttribute('cx', mx); dot.setAttribute('cy', my);
  dot.setAttribute('r', String(5*scale)); dot.setAttribute('fill', hue);
  dot.setAttribute('fill-opacity', '0.95'); dot.setAttribute('stroke', '#0b0d12'); dot.setAttribute('stroke-width', String(1.2*scale));
  svg.appendChild(dot);

  // MAXå¤–å‘¨â—ï¼ˆåŒç‡ãƒˆãƒƒãƒ—ã‚‚å…¨éƒ¨ï¼‰
  strongestAxes(vec).forEach(ii=>{
    const a = ang[ii];
    const mx2 = cx+Math.cos(a)*r, my2 = cy+Math.sin(a)*r;
    const m2 = document.createElementNS('http://www.w3.org/2000/svg','circle');
    m2.setAttribute('cx', mx2); m2.setAttribute('cy', my2);
    m2.setAttribute('r', String(4*scale));
    m2.setAttribute('fill', '#ffffff');
    m2.setAttribute('stroke', '#0b0d12');
    m2.setAttribute('stroke-width', String(1.2*scale));
    svg.appendChild(m2);
  });
}

function hexToRgba(hex, a){
  if(hex.startsWith('rgba')) return hex.replace(/, ?\d?\.?\d+\)/, ','+a+')');
  const v = hex.replace('#',''); const num = parseInt(v,16);
  const r = (v.length===3) ? ((num>>8)&0xF)*17 : (num>>16)&0xFF;
  const g = (v.length===3) ? ((num>>4)&0xF)*17 : (num>>8)&0xFF;
  const b = (v.length===3) ? ((num>>0)&0xF)*17 : (num>>0)&0xFF;
  return `rgba(${r},${g},${b},${a})`;
}

/* ========= ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ ========= */
let _resizeTimer=null;
window.addEventListener('resize', ()=>{ 
  if(el('result').style.display!=='block') return;
  clearTimeout(_resizeTimer);
  _resizeTimer=setTimeout(()=>{
    // å†æç”»ï¼ˆvecã‚’å†è¨ˆç®—ã—ãªã„ã®ã§ã€ãã®å ´ã®ã‚¿ã‚°å€¤ã‹ã‚‰å¾©å…ƒã¯ã›ãš redrawã¯finishå†…ã‹ã‚‰å‘¼ã¶æƒ³å®šï¼‰
    // ã“ã“ã§ã¯ç°¡æ˜“ã«: ç›´è¿‘ã®å‚¾å‘ã‚’ä¿æŒã§ãã‚‹ã‚ˆã† finish()å†…ã§vecã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ç½®ã„ã¦ã‚‚OK
    if(window.__lastVec && window.__lastColors){
      drawRadarResponsive(window.__lastVec, window.__lastColors);
    }
  }, 120);
});

/* ä»•ä¸Šã’ï¼šæœ€å¾Œã«ä½¿ã£ãŸãƒ™ã‚¯ãƒˆãƒ«/è‰²ã‚’ä¿æŒ */
window.__lastVec = null;
window.__lastColors = null;
const _old_finish = finish;
finish = function(){
  // ã‚ªãƒªã‚¸ãƒŠãƒ«finishã®å‡¦ç†ã‚’ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ãŸã‚ã€ä¸Šã®finishæœ¬æ–‡ã‚’é–¢æ•°ã«ã—ã¦ã„ã‚‹ã€‚
  // ã“ã“ã¯ãƒ©ãƒƒãƒ—ã§ã¯ãªãæ—¢ã«æœ¬æ–‡ãŒä¸Šã«ã‚ã‚‹ã®ã§ã€ã“ã®ãƒ©ãƒƒãƒ—ã¯ã‚¹ã‚­ãƒƒãƒ—ã€‚
};

/* finishæœ¬æ–‡å†…ã§æœ€å¾Œã«å®Ÿè¡Œã™ã‚‹ã‚ˆã†ãƒ•ãƒƒã‚¯ï¼ˆä¸Šã®finishæœ«å°¾ã«è¿½è¨˜ï¼‰ */
(function hookFinish(){
  const _render = drawRadarResponsive;
  // æ—¢å­˜ finish ã®æœ€å¾Œã§ã‚»ãƒƒãƒˆã™ã‚‹ãŸã‚ã€MutationObserverã§ result ãŒå‡ºãŸã‚‰æ‹¾ã†
  const obs = new MutationObserver(()=>{
    const svg = el('radar');
    if(svg && svg.childNodes.length){ obs.disconnect(); }
  });
  // ã“ã“ã¯è»½ã„ä¿é™ºã€‚å®Ÿä½“ã¯ finish() å†…ã®æœ«å°¾ã§è¨­å®šã™ã‚‹ï¼š
  // window.__lastVec, window.__lastColors ã‚’ç›´æ¥æ›´æ–°ã§ãã‚‹ã‚ˆã†ã€drawRadarResponsiveã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹
  window.drawRadar = function(vec, colors){
    window.__lastVec = vec.slice();
    window.__lastColors = colors.slice();
    _render(vec, colors);
  };
})();
</script>
</body>
</html>
